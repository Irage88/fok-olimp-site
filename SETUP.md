# Руководство по установке и настройке

## Содержание

- [Требования](#требования)
- [Установка](#установка)
- [Создание файла .env](#создание-файла-env)
- [Инициализация базы данных](#инициализация-базы-данных)
- [Запуск backend](#запуск-backend)
- [Доступ к frontend](#доступ-к-frontend)
- [Устранение неполадок](#устранение-неполадок)
- [Сброс базы данных](#сброс-базы-данных)

## Требования

- **Node.js** версии 14.0.0 или выше
- **npm** (устанавливается вместе с Node.js)
- **Windows PowerShell** (для выполнения команд)

Проверьте версию Node.js:
```powershell
node --version
```

Если Node.js не установлен, скачайте и установите его с [официального сайта](https://nodejs.org/).

## Установка

1. **Откройте PowerShell** и перейдите в директорию проекта:
   ```powershell
   cd D:\Practic\test\test_3\project
   ```

2. **Перейдите в директорию backend:**
   ```powershell
   cd backend
   ```

3. **Установите зависимости:**
   ```powershell
   npm install
   ```

   Эта команда установит все необходимые пакеты, указанные в `package.json`:
   - express
   - sqlite3
   - bcryptjs
   - jsonwebtoken
   - dotenv
   - cors
   - nodemon (для разработки)

## Создание файла .env

1. **Скопируйте файл `.env.example` в `.env`** в директории `backend`:
   ```powershell
   cd backend
   Copy-Item .env.example .env
   ```

2. **Откройте файл `.env`** и замените значение `JWT_SECRET` на надёжный случайный ключ. В production используйте длинную случайную строку (минимум 32 символа).

   **ВАЖНО:** Файл `.env` содержит секретные данные и не должен быть закоммичен в Git. Он уже добавлен в `.gitignore`.

   Пример генерации секретного ключа в PowerShell:
   ```powershell
   -join ((65..90) + (97..122) + (48..57) | Get-Random -Count 32 | % {[char]$_})
   ```

## Инициализация базы данных

После установки зависимостей и создания `.env` файла выполните:

```powershell
npm run init-db
```

Эта команда:
- Создаст файл `database.sqlite` в директории `backend`
- Создаст все необходимые таблицы (users, services, bookings, contacts)
- Заполнит таблицу `services` начальными данными из `seed-services.json`

Если команда выполнилась успешно, вы увидите сообщение об успешной инициализации базы данных.

## Запуск backend

### Режим разработки (с автоперезагрузкой)

```powershell
npm run dev
```

Сервер запустится с использованием `nodemon`, который автоматически перезагружает сервер при изменении файлов.

### Режим production

```powershell
npm start
```

Сервер будет доступен по адресу: `http://localhost:3000`

Вы должны увидеть сообщение в консоли о том, что сервер запущен на порту 3000.

## Доступ к frontend

Frontend автоматически обслуживается Express сервером как статические файлы из директории `/frontend`.

После запуска backend откройте в браузере:

- **Главная страница:** `http://localhost:3000/` или `http://localhost:3000/index.html`
- **Регистрация:** `http://localhost:3000/register` или `http://localhost:3000/register.html`
- **Вход:** `http://localhost:3000/login` или `http://localhost:3000/login.html`
- **Личный кабинет:** `http://localhost:3000/dashboard` или `http://localhost:3000/dashboard.html`
- **Услуги:** `http://localhost:3000/services` или `http://localhost:3000/services.html`
- **Контакты:** `http://localhost:3000/contacts` или `http://localhost:3000/contacts.html`

**Примечание:** Приложение поддерживает чистые URL без расширения `.html`. Старые URL с `.html` автоматически перенаправляются на чистые.

## Устранение неполадок

### Ошибка: "npm не распознаётся как команда"

**Проблема:** Node.js не установлен или не добавлен в PATH.

**Решение:**
1. Установите Node.js с [официального сайта](https://nodejs.org/)
2. Перезапустите PowerShell после установки
3. Проверьте установку: `node --version` и `npm --version`

### Ошибка выполнения скриптов в PowerShell

**Проблема:** Политика выполнения скриптов PowerShell блокирует выполнение.

**Решение:**
Выполните в PowerShell от имени администратора:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### Ошибка: "JWT_SECRET is required"

**Проблема:** Файл `.env` не создан или не содержит переменную `JWT_SECRET`.

**Решение:**
1. Убедитесь, что файл `.env` находится в директории `backend`
2. Проверьте, что файл содержит строку `JWT_SECRET=...`
3. Перезапустите сервер после создания/изменения `.env`

### Ошибки с базой данных SQLite

**Проблема:** Ошибки при создании или доступе к `database.sqlite`.

**Решение:**
1. Убедитесь, что у вас есть права на запись в директории `backend`
2. Удалите существующий файл `database.sqlite` (если есть) и запустите `npm run init-db` снова
3. Проверьте, что директория `backend` существует и доступна

### Порт 3000 уже занят

**Проблема:** Другой процесс использует порт 3000.

**Решение:**
1. Измените порт в файле `.env` на другой (например, `PORT=3001`)
2. Или завершите процесс, использующий порт 3000:
   ```powershell
   netstat -ano | findstr :3000
   taskkill /PID <PID> /F
   ```

### Модули не найдены после установки

**Проблема:** Зависимости не установились корректно.

**Решение:**
1. Удалите директорию `node_modules` и файл `package-lock.json`
2. Выполните `npm install` снова
3. Убедитесь, что вы находитесь в директории `backend`

## Сброс базы данных

Если необходимо сбросить базу данных и начать заново:

1. **Остановите сервер** (если он запущен) — нажмите `Ctrl+C` в терминале

2. **Запустите скрипт сброса базы данных:**
   ```powershell
   cd backend
   npm run reset-db
   ```

3. **Запустите сервер снова:**
   ```powershell
   npm start
   ```

**Внимание:** Это удалит все данные (пользователей, бронирования, сообщения). Используйте только для разработки и тестирования. Скрипт автоматически удалит базу данных и пересоздаст её с начальными данными услуг.

## Проверка работоспособности

После успешной установки и запуска проверьте:

1. **Сервер запущен:** В консоли должно быть сообщение о запуске на порту 3000
2. **База данных создана:** Файл `backend/database.sqlite` должен существовать
3. **Frontend доступен:** Откройте `http://localhost:3000/` в браузере
4. **API работает:** Откройте `http://localhost:3000/api/services` в браузере — должен вернуться JSON со списком услуг

## Дополнительная информация

- **Хранение токенов:** JWT токены хранятся в `localStorage` браузера с ключом `token`
- **База данных:** SQLite файл находится в `backend/database.sqlite`
- **Логи:** Ошибки и информация выводятся в консоль, где запущен сервер
